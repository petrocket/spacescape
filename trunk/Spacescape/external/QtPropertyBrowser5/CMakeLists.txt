FILE(WRITE .licenseAccepted "license accepted")
MESSAGE(STATUS "Making QtPropertyBrowser")
IF(UNIX)
	EXECUTE_PROCESS(COMMAND ./configure -library WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR})
	EXECUTE_PROCESS(COMMAND qmake qtpropertybrowser.pro WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR})
	EXECUTE_PROCESS(COMMAND make WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR})

ELSEIF(APPLE)
	EXECUTE_PROCESS(COMMAND ./configure -library WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR})
	EXECUTE_PROCESS(COMMAND qmake qtpropertybrowser.pro WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR})
	EXECUTE_PROCESS(COMMAND make WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR})

ELSEIF(WIN32)
	EXECUTE_PROCESS(COMMAND qmake qtpropertybrowser.pro WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR})
	EXECUTE_PROCESS(COMMAND vcvars32-nmake.bat WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR} RESULT_VARIABLE ret_var OUTPUT_VARIABLE ret_val ERROR_VARIABLE ret_val )
ENDIF(UNIX)
# FIND_LIBRARY(QtPropertyBrowser_Library_DBG NAMES QtSolutions_PropertyBrowser-2.5d PATHS lib/)
FIND_LIBRARY(QtPropertyBrowser_Library_DBG NAMES QtSolutions_PropertyBrowser-head_debug PATHS lib/)
FIND_LIBRARY(QtPropertyBrowser_Library_REL NAMES QtSolutions_PropertyBrowser-head PATHS lib/)

set(QtPropertyBrowser_Libraries ${QtPropertyBrowser_Library_REL} PARENT_SCOPE)

IF(NOT QtPropertyBrowser_Library_REL)
	MESSAGE(FATAL_ERROR "Failed to make QtPropertyBrowser - check that qmake.exe and vcvars32.bat are in your PATH")
	MESSAGE(STATUS ${ret_val})
ELSE(NOT QtPropertyBrowser_Library_REL)
	MESSAGE(STATUS "Successfully made QtPropertyBrowser")
	FILE(COPY lib/ DESTINATION ${CMAKE_SOURCE_DIR}/Spacescape/lib  FILES_MATCHING PATTERN "${QtPropertyBrowser_Library_REL}")
	if(WIN32)
		FILE(COPY lib/QtSolutions_PropertyBrowser-2.5.dll DESTINATION ${CMAKE_SOURCE_DIR}/Spacescape/app/win/release/)
		FILE(COPY lib/QtSolutions_PropertyBrowser-2.5d.dll DESTINATION ${CMAKE_SOURCE_DIR}/Spacescape/app/win/debug/)
	ENDIF(WIN32)
ENDIF(NOT QtPropertyBrowser_Library_REL)
